<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HALF-BOT - Black Mesa Research Facility</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Courier New", monospace;
      }

      body {
        background: #0a0a12;
        color: #b8d4e3;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
        background-image: 
          radial-gradient(circle at 10% 20%, rgba(28, 58, 82, 0.2) 0%, transparent 20%),
          radial-gradient(circle at 90% 80%, rgba(28, 58, 82, 0.2) 0%, transparent 20%),
          linear-gradient(135deg, #0a0a12 0%, #1a1a2a 100%);
      }

      .container {
        width: 100%;
        max-width: 900px;
        background-color: #0f1520;
        border-radius: 5px;
        box-shadow: 
          0 0 20px rgba(0, 150, 255, 0.3),
          inset 0 0 20px rgba(0, 0, 0, 0.5);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        height: 85vh;
        border: 1px solid #2a4a6a;
        position: relative;
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, transparent, #4a9ae9, transparent);
        animation: scanline 3s linear infinite;
      }

      @keyframes scanline {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      .header {
        background: linear-gradient(to bottom, #1a2a3a, #0f1720);
        color: #b8d4e3;
        padding: 15px 20px;
        text-align: center;
        position: relative;
        border-bottom: 1px solid #2a4a6a;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
      }

      .header h1 {
        font-size: 1.8rem;
        margin-bottom: 5px;
        color: #4a9ae9;
        text-shadow: 0 0 10px rgba(74, 154, 233, 0.5);
        letter-spacing: 2px;
        font-weight: bold;
      }

      .header p {
        font-size: 0.9rem;
        opacity: 0.8;
        color: #8fa8b8;
      }

      .lambda-logo {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 2rem;
        color: #ff6b00;
        filter: drop-shadow(0 0 5px #ff6b00);
      }

      .chat-container {
        display: flex;
        flex-direction: column;
        height: 100%;
        background-color: #0a0e14;
      }

      .api-key-section {
        padding: 15px 20px;
        background-color: #131a25;
        border-bottom: 1px solid #2a4a6a;
        position: relative;
      }

      .api-key-section::before {
        content: "SECURITY CLEARANCE REQUIRED";
        position: absolute;
        top: -10px;
        left: 20px;
        background: #0a0e14;
        padding: 0 10px;
        font-size: 0.7rem;
        color: #8fa8b8;
        letter-spacing: 1px;
      }

      .api-key-form {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .api-key-input {
        flex: 1;
        min-width: 200px;
        padding: 10px 15px;
        border: 1px solid #2a4a6a;
        border-radius: 3px;
        font-size: 0.9rem;
        transition: all 0.3s;
        background-color: #0a0e14;
        color: #b8d4e3;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
      }

      .api-key-input:focus {
        outline: none;
        border-color: #4a9ae9;
        box-shadow: 
          inset 0 0 5px rgba(0, 0, 0, 0.5),
          0 0 5px rgba(74, 154, 233, 0.5);
      }

      .api-selector {
        width: 100%;
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .api-selector label {
        color: #8fa8b8;
        font-size: 0.9rem;
      }

      .api-selector select {
        padding: 6px 10px;
        border-radius: 3px;
        border: 1px solid #2a4a6a;
        background-color: #0a0e14;
        color: #b8d4e3;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
      }

      .btn {
        padding: 10px 15px;
        background: linear-gradient(to bottom, #2a4a6a, #1a2a3a);
        color: #b8d4e3;
        border: 1px solid #2a4a6a;
        border-radius: 3px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        text-transform: uppercase;
        font-size: 0.8rem;
        letter-spacing: 1px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .btn:hover {
        background: linear-gradient(to bottom, #3a5a7a, #2a3a4a);
        border-color: #4a9ae9;
        box-shadow: 0 0 10px rgba(74, 154, 233, 0.3);
      }

      .btn:active {
        transform: translateY(1px);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .chat-box {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 15px;
        background-color: #0a0e14;
        background-image: 
          linear-gradient(rgba(10, 14, 20, 0.9), rgba(10, 14, 20, 0.9)),
          url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%230a0e14"/><path d="M0 0L100 100M100 0L0 100" stroke="%23131a25" stroke-width="0.5"/></svg>');
      }

      .message {
        max-width: 80%;
        padding: 12px 18px;
        border-radius: 5px;
        line-height: 1.5;
        position: relative;
        animation: fadeIn 0.3s ease-out;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .user-message {
        align-self: flex-end;
        background: linear-gradient(to right, #2a4a6a, #1a2a3a);
        color: #b8d4e3;
        border: 1px solid #3a5a7a;
        border-right: 3px solid #4a9ae9;
      }

      .bot-message {
        align-self: flex-start;
        background: linear-gradient(to right, #1a2a3a, #131a25);
        color: #b8d4e3;
        border: 1px solid #2a4a6a;
        border-left: 3px solid #ff6b00;
      }

      .warning-message {
        align-self: center;
        background-color: #332211;
        color: #ffaa44;
        border: 1px solid #664422;
        border-radius: 5px;
        max-width: 90%;
        text-align: center;
        font-size: 0.9rem;
        border-left: 3px solid #ffaa44;
        border-right: 3px solid #ffaa44;
      }

      .error-message {
        align-self: center;
        background-color: #331111;
        color: #ff4444;
        border: 1px solid #662222;
        border-radius: 5px;
        max-width: 90%;
        text-align: center;
        font-size: 0.9rem;
        border-left: 3px solid #ff4444;
        border-right: 3px solid #ff4444;
      }

      .input-section {
        padding: 15px 20px;
        background-color: #131a25;
        border-top: 1px solid #2a4a6a;
        display: flex;
        gap: 10px;
        height: auto;
      }

      .message-input {
        flex: 1;
        padding: 12px 15px;
        border: 1px solid #2a4a6a;
        border-radius: 3px;
        font-size: 0.9rem;
        transition: all 0.3s;
        background-color: #0a0e14;
        color: #b8d4e3;
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
      }

      .message-input:focus {
        outline: none;
        border-color: #4a9ae9;
        box-shadow: 
          inset 0 0 5px rgba(0, 0, 0, 0.5),
          0 0 5px rgba(74, 154, 233, 0.5);
      }

      .send-btn {
        padding: 12px 20px;
        background: linear-gradient(to bottom, #2a4a6a, #1a2a3a);
        color: #b8d4e3;
        border: 1px solid #2a4a6a;
        border-radius: 3px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      }

      .send-btn:hover {
        background: linear-gradient(to bottom, #3a5a7a, #2a3a4a);
        border-color: #4a9ae9;
        box-shadow: 0 0 10px rgba(74, 154, 233, 0.3);
      }

      .send-btn:active {
        transform: translateY(1px);
      }

      .send-btn:disabled {
        background: #1a2a3a;
        border-color: #2a4a6a;
        color: #5a7a8a;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .typing-indicator {
        display: inline-block;
        padding: 12px 18px;
        background: linear-gradient(to right, #1a2a3a, #131a25);
        border: 1px solid #2a4a6a;
        border-radius: 5px;
        align-self: flex-start;
        border-left: 3px solid #ff6b00;
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #ff6b00;
        animation: typing 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .typing-dot:nth-child(2) {
        animation-delay: -0.16s;
      }

      @keyframes typing {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .info-section {
        padding: 10px 20px;
        background-color: #131a25;
        border-top: 1px solid #2a4a6a;
        font-size: 0.75rem;
        color: #8fa8b8;
        text-align: center;
      }

      .info-section a {
        color: #4a9ae9;
        text-decoration: none;
        font-weight: 600;
      }

      .info-section a:hover {
        text-decoration: underline;
        color: #6ab9ff;
      }

      .code-block {
        background-color: #0a0e14;
        border: 1px solid #2a4a6a;
        border-radius: 3px;
        padding: 10px;
        margin: 10px 0;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        overflow-x: auto;
        white-space: pre-wrap;
        color: #b8d4e3;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      }

      .api-info {
        margin-top: 10px;
        font-size: 0.75rem;
        color: #8fa8b8;
      }

      .scientist-signature {
        margin-top: 5px;
        font-style: italic;
        color: #ff6b00;
        font-size: 0.8rem;
      }

      @media (max-width: 768px) {
        .container {
          height: 95vh;
        }

        .message {
          max-width: 90%;
        }

        .header h1 {
          font-size: 1.5rem;
        }

        .lambda-logo {
          font-size: 1.5rem;
          top: 18px;
        }

        .api-key-form {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>HALF-BOT - BLACK MESA RESEARCH FACILITY</h1>
        <p>Sistema de Consulta Científica - Nível de Acesso: CLASSIFICADO</p>
        <div class="lambda-logo">λ</div>
      </div>

      <div class="chat-container">
        <div class="api-key-section">
          <div class="api-selector">
            <label for="apiProvider">SELECIONE A FONTE DE DADOS:</label>
            <select id="apiProvider">
              <option value="gemini">
                GOOGLE GEMINI (RECOMENDADO - ACESSO LIVRE)
              </option>
              <option value="deepseek">
                DEEPSEEK (PODE REQUERER AUTORIZAÇÃO SUPERIOR)
              </option>
            </select>
          </div>
          <div class="api-key-form">
            <input
              type="password"
              class="api-key-input"
              placeholder="INSIRA SUA CHAVE DE ACESSO..."
              id="apiKey"
            />
            <button class="btn" id="saveApiKey">AUTORIZAR ACESSO</button>
          </div>
          <div class="api-info" id="apiInfo">
            PARA GOOGLE GEMINI: Obtenha uma chave de acesso em
            <a href="https://aistudio.google.com/app/apikey" target="_blank"
              >GOOGLE AI STUDIO</a
            >
          </div>
        </div>

        <div class="chat-box" id="chatBox">
          <div class="message bot-message">
            [INICIANDO SISTEMA HALF-BOT...]
            <br><br>
            Olá, sou o Dr. Arne Magnusson, cientista sênior da Black Mesa. Este sistema foi desenvolvido para fornecer informações sobre o universo de Half-Life, incluindo personagens, locais, eventos e tecnologia.
            <br><br>
            Por favor, selecione uma fonte de dados e insira sua chave de acesso para começarmos.
            <div class="scientist-signature">- Dr. Arne Magnusson, Black Mesa Research Facility</div>
          </div>
        </div>

        <div class="input-section">
          <input
            type="text"
            class="message-input"
            placeholder="DIGITE SUA CONSULTA SOBRE HALF-LIFE..."
            id="messageInput"
            disabled
          />
          <button class="send-btn" id="sendMessage" disabled>
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M22 2L11 13"
                stroke="#b8d4e3"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M22 2L15 22L11 13L2 9L22 2Z"
                stroke="#b8d4e3"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </button>
        </div>

        <div class="info-section">
          <strong>GOOGLE GEMINI:</strong> Obtenha uma chave de acesso em
          <a href="https://aistudio.google.com/app/apikey" target="_blank"
            >GOOGLE AI STUDIO</a
          >
          | <strong>DEEPSEEK:</strong>
          <a href="https://platform.deepseek.com/api_keys" target="_blank"
            >DEEPSEEK PLATFORM</a
          >
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const apiProviderSelect = document.getElementById("apiProvider");
        const apiKeyInput = document.getElementById("apiKey");
        const apiInfo = document.getElementById("apiInfo");
        const saveApiKeyBtn = document.getElementById("saveApiKey");
        const messageInput = document.getElementById("messageInput");
        const sendMessageBtn = document.getElementById("sendMessage");
        const chatBox = document.getElementById("chatBox");

        let apiKey = "";
        let apiProvider = "gemini";
        let isProcessing = false;

        // Atualizar informações da API quando o provedor mudar
        apiProviderSelect.addEventListener("change", function () {
          apiProvider = this.value;
          updateApiInfo();
        });

        function updateApiInfo() {
          if (apiProvider === "gemini") {
            apiInfo.innerHTML =
              'PARA GOOGLE GEMINI: Obtenha uma chave de acesso em <a href="https://aistudio.google.com/app/apikey" target="_blank">GOOGLE AI STUDIO</a>';
            apiKeyInput.placeholder = "INSIRA SUA CHAVE DO GOOGLE GEMINI...";
          } else {
            apiInfo.innerHTML =
              'PARA DEEPSEEK: Obtenha uma chave em <a href="https://platform.deepseek.com/api_keys" target="_blank">DEEPSEEK PLATFORM</a> (PODE REQUERER AUTORIZAÇÃO SUPERIOR)';
            apiKeyInput.placeholder = "INSIRA SUA CHAVE DO DEEPSEEK...";
          }
        }

        // Inicializar informações da API
        updateApiInfo();

        // Salvar a chave da API
        saveApiKeyBtn.addEventListener("click", function () {
          apiKey = apiKeyInput.value.trim();

          if (!apiKey) {
            addMessage("POR FAVOR, INSIRA UMA CHAVE DE ACESSO VÁLIDA.", "warning");
            return;
          }

          // Esconder a chave na interface
          apiKeyInput.type = "password";
          apiKeyInput.value = "••••••••••••••••";
          apiKeyInput.disabled = true;
          saveApiKeyBtn.disabled = true;
          apiProviderSelect.disabled = true;

          // Ativar campos de mensagem
          messageInput.disabled = false;
          sendMessageBtn.disabled = false;

          addMessage(
            `CHAVE DE ACESSO ${
              apiProvider === "gemini" ? "GOOGLE GEMINI" : "DEEPSEEK"
            } AUTORIZADA COM SUCESSO! AGORA VOCÊ PODE FAZER SUAS CONSULTAS SOBRE HALF-LIFE.`,
            "bot"
          );
          messageInput.focus();
        });

        // Enviar mensagem ao clicar no botão
        sendMessageBtn.addEventListener("click", sendMessage);

        // Enviar mensagem ao pressionar Enter
        messageInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !isProcessing) {
            sendMessage();
          }
        });

        async function sendMessage() {
          const message = messageInput.value.trim();

          if (!message || isProcessing) return;

          // Verificar se a pergunta é sobre Half-Life
          if (!isHalfLifeRelated(message)) {
            addMessage(
              "POR FAVOR, FAÇA APENAS PERGUNTAS RELACIONADAS AO UNIVERSO DE HALF-LIFE. ESTE SISTEMA É ESPECIALIZADO EM INFORMAÇÕES SOBRE A BLACK MESA, COMBINE, PERSONAGENS E EVENTOS DO JOGO.",
              "warning"
            );
            messageInput.value = "";
            return;
          }

          // Adicionar mensagem do usuário ao chat
          addMessage(message, "user");
          messageInput.value = "";

          // Mostrar indicador de digitação
          showTypingIndicator();

          // Processar a pergunta
          await processQuestion(message);
        }

        async function processQuestion(question) {
          isProcessing = true;
          sendMessageBtn.disabled = true;

          try {
            let response;

            if (apiProvider === "gemini") {
              response = await callGeminiAPI(question);
            } else {
              response = await callDeepSeekAPI(question);
            }

            // Remover indicador de digitação
            removeTypingIndicator();

            // Exibir a resposta
            addMessage(response, "bot");
          } catch (error) {
            console.error("Erro ao processar a pergunta:", error);
            removeTypingIndicator();

            let errorMessage =
              "DESCULPE, OCORREU UM ERRO AO PROCESSAR SUA CONSULTA. ";

            if (error.message.includes("402")) {
              errorMessage +=
                "A FONTE DE DADOS SELECIONADA REQUER AUTORIZAÇÃO SUPERIOR. POR FAVOR, USE O GOOGLE GEMINI QUE TEM ACESSO LIVRE.";
            } else if (error.message.includes("401")) {
              errorMessage +=
                "CHAVE DE ACESSO INVÁLIDA OU NÃO AUTORIZADA. VERIFIQUE SUA CHAVE E TENTE NOVAMENTE.";
            } else if (error.message.includes("429")) {
              errorMessage +=
                "LIMITE DE CONSULTAS EXCEDIDO. TENTE NOVAMENTE MAIS TARDE.";
            } else if (error.message.includes("500")) {
              errorMessage +=
                "ERRO INTERNO DO SISTEMA. TENTE NOVAMENTE EM ALGUNS INSTANTES.";
            } else {
              errorMessage += `DETALHES: ${error.message}`;
            }

            addMessage(errorMessage, "error");
          } finally {
            isProcessing = false;
            sendMessageBtn.disabled = false;
          }
        }

        async function callGeminiAPI(question) {
          // Usando a API do Google Gemini
          const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

          const response = await fetch(apiUrl, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              contents: [
                {
                  parts: [
                    {
                      text: `Você é um cientista da Black Mesa Research Facility especializado no universo de Half-Life. Responda apenas perguntas relacionadas a Half-Life, incluindo personagens, locais, eventos, tecnologia, enredo e elementos do jogo. Se a pergunta não for sobre Half-Life, explique educadamente que você só pode ajudar com questões relacionadas ao universo do jogo.

Responda sempre em um tom apropriado para um cientista da Black Mesa, usando terminologia científica quando apropriado e mantendo o estilo do universo de Half-Life. Assine suas respostas como "Dr. Arne Magnusson, Black Mesa Research Facility".

Pergunta do usuário: ${question}`,
                    },
                  ],
                },
              ],
              generationConfig: {
                temperature: 0.7,
                maxOutputTokens: 1000,
              },
            }),
          });

          if (!response.ok) {
            throw new Error(
              `Erro na API: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json();

          if (data.candidates && data.candidates.length > 0) {
            return data.candidates[0].content.parts[0].text;
          } else {
            throw new Error("Resposta da API não contém dados válidos");
          }
        }

        async function callDeepSeekAPI(question) {
          // Tentativa com a API DeepSeek (pode retornar erro 402)
          const response = await fetch(
            "https://api.deepseek.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                Authorization: `Bearer ${apiKey}`,
              },
              body: JSON.stringify({
                model: "deepseek-chat",
                messages: [
                  {
                    role: "system",
                    content: "Você é um cientista da Black Mesa Research Facility especializado no universo de Half-Life. Responda apenas perguntas relacionadas a Half-Life, incluindo personagens, locais, eventos, tecnologia, enredo e elementos do jogo. Se a pergunta não for sobre Half-Life, explique educadamente que você só pode ajudar com questões relacionadas ao universo do jogo. Responda sempre em um tom apropriado para um cientista da Black Mesa, usando terminologia científica quando apropriado e mantendo o estilo do universo de Half-Life. Assine suas respostas como 'Dr. Arne Magnusson, Black Mesa Research Facility'.",
                  },
                  {
                    role: "user",
                    content: question,
                  },
                ],
                max_tokens: 1000,
                temperature: 0.7,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(
              `Erro na API: ${response.status} - ${response.statusText}`
            );
          }

          const data = await response.json();

          if (data.choices && data.choices.length > 0) {
            return data.choices[0].message.content;
          } else {
            throw new Error("Resposta da API não contém dados válidos");
          }
        }

        function isHalfLifeRelated(message) {
          const halfLifeKeywords = [
            "half-life",
            "half life",
            "black mesa",
            "gordon freeman",
            "alyx vance",
            "g-man",
            "combine",
            "city 17",
            "lambda",
            "xen",
            "headcrab",
            "zombie",
            "vortigaunt",
            "dr. breen",
            "eli vance",
            "dr. kleiner",
            "barney calhoun",
            "dr. magnusson",
            "hecu",
            "crowbar",
            "gravity gun",
            "lambda complex",
            "nova prospect",
            "ravenholm",
            "dr. arne magnusson",
            "resonance cascade",
            "teleport",
            "portal",
            "borealis",
            "aperture science",
            "valve",
            "hl1",
            "hl2",
            "episode one",
            "episode two",
            "alyx",
            "citadel",
            "strider",
            "gunship",
            "antlion",
            "antlion guard",
            "advisor",
            "stalker",
            "civil protection",
            "overwatch",
            "breencast",
            "lambda logo",
            "hev suit",
            "hazardous environment",
            "scientist",
            "guard",
            "security guard"
          ];

          const lowerMessage = message.toLowerCase();

          // Verificar se a mensagem contém palavras-chave relacionadas a Half-Life
          return halfLifeKeywords.some((keyword) =>
            lowerMessage.includes(keyword.toLowerCase())
          );
        }

        function addMessage(text, sender) {
          const messageDiv = document.createElement("div");
          messageDiv.classList.add("message");

          if (sender === "user") {
            messageDiv.classList.add("user-message");
            messageDiv.textContent = text;
          } else if (sender === "bot") {
            messageDiv.classList.add("bot-message");

            // Processar a resposta para formatar blocos de código
            const formattedText = formatCodeBlocks(text);
            messageDiv.innerHTML = formattedText;
          } else if (sender === "warning") {
            messageDiv.classList.add("warning-message");
            messageDiv.textContent = text;
          } else if (sender === "error") {
            messageDiv.classList.add("error-message");
            messageDiv.textContent = text;
          }

          chatBox.appendChild(messageDiv);

          // Rolagem automática para a última mensagem
          chatBox.scrollTop = chatBox.scrollHeight;
        }

        function formatCodeBlocks(text) {
          // Substituir blocos de código marcados com ``` por elementos pre/code
          return text.replace(
            /```(\w+)?\n([\s\S]*?)```/g,
            function (match, language, code) {
              return `<div class="code-block"><pre><code>${code.trim()}</code></pre></div>`;
            }
          );
        }

        function showTypingIndicator() {
          const typingDiv = document.createElement("div");
          typingDiv.classList.add("typing-indicator");
          typingDiv.id = "typingIndicator";

          const dotsDiv = document.createElement("div");
          dotsDiv.classList.add("typing-dots");

          for (let i = 0; i < 3; i++) {
            const dot = document.createElement("div");
            dot.classList.add("typing-dot");
            dotsDiv.appendChild(dot);
          }

          typingDiv.appendChild(dotsDiv);
          chatBox.appendChild(typingDiv);

          // Rolagem automática para o indicador de digitação
          chatBox.scrollTop = chatBox.scrollHeight;
        }

        function removeTypingIndicator() {
          const typingIndicator = document.getElementById("typingIndicator");
          if (typingIndicator) {
            typingIndicator.remove();
          }
        }
      });
    </script>
  </body>
</html>